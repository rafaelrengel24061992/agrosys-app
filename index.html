<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSys Pro</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <style>
        body { background-color: #f0fdf4; margin: 0; font-family: sans-serif; }
        .aba-btn { flex: 1; padding: 15px; text-align: center; cursor: pointer; border: none; background: #059669; color: white; opacity: 0.6; }
        .aba-ativa { opacity: 1; font-weight: bold; background: #047857; }
        .card { background: white; border-radius: 15px; padding: 20px; shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const firebaseConfig = {
            apiKey: "AIzaSyDn0FwwFZNmd2bhJVwR8xbiPeCB1LEe6xw",
            authDomain: "agrosys-e3d99.firebaseapp.com",
            projectId: "agrosys-e3d99",
            storageBucket: "agrosys-e3d99.firebasestorage.app",
            messagingSenderId: "85637972190",
            appId: "1:85637972190:web:2f0f2a8b59105a0499824f"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const RACAS = ["PINTOS P/ CORTE 1 DIA", "PINTOS P/ CORTE BRANCOS RECRIADOS", "PESADÃO CAIPIRA RECRIADO", "CAIPIRA NEGRO RECRIADO", "PESCOÇO PELADO MISTO RECRIADO", "CARIJO MISTO RECRIADO", "MESCLADO CAIPIRA RECRIADO", "PESCOÇO PELADO CARIJO MISTO RECRIADO", "PINTO PESCOÇO PELADO BRANCO RECRIADO", "CODORNAS FÊMEAS", "POSTURA CREME RECRIADA", "POSTURA BRANCA RECRIADA", "POSTURA NEGRA RECRIADA", "POSTURA VERMELHA RECRIADA", "POSTURA CINZA RECRIADA", "POSTURA OVOS AZUIS RECRIADA", "POSTURA VERMELHA OVOS VERDES"];

        function App() {
            const [logado, setLogado] = React.useState(sessionStorage.getItem('ok') === 's');
            const [senha, setSenha] = React.useState('');
            const [aba, setAba] = React.useState('pedir');
            const [pedidos, setPedidos] = React.useState([]);
            const [form, setForm] = React.useState({ cliente: '', tel: '', itens: [{ raca: '', qtd: '' }] });

            React.useEffect(() => {
                if (!logado) return;
                return db.collection("encomendas").orderBy("data", "desc").onSnapshot(s => {
                    setPedidos(s.docs.map(d => ({ id: d.id, ...d.data() })));
                });
            }, [logado]);

            const login = () => {
                if (senha === "1234") {
                    setLogado(true);
                    sessionStorage.setItem('ok', 's');
                } else alert("Incorreto");
            };

            const salvar = async () => {
                if (!form.cliente || !form.itens[0].raca) return alert("Preencha tudo");
                await db.collection("encomendas").add({
                    ...form,
                    data: firebase.firestore.FieldValue.serverTimestamp()
                });
                setForm({ cliente: '', tel: '', itens: [{ raca: '', qtd: '' }] });
                alert("Salvo!");
            };

            if (!logado) return (
                <div className="flex items-center justify-center min-h-screen bg-emerald-900 p-6">
                    <div className="bg-white p-8 rounded-3xl w-full max-w-xs shadow-2xl">
                        <h1 className="text-2xl font-black text-emerald-700 text-center mb-6">AGROSYS</h1>
                        <input type="password" placeholder="Senha" className="w-full p-3 border rounded-xl mb-4 text-center" onChange={e => setSenha(e.target.value)} />
                        <button onClick={login} className="w-full bg-emerald-600 text-white p-3 rounded-xl font-bold">ENTRAR</button>
                    </div>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-xl">
                    <div className="flex bg-emerald-600 text-white">
                        <div onClick={() => setAba('pedir')} className={`aba-btn ${aba === 'pedir' ? 'aba-ativa' : ''}`}>PEDIR</div>
                        <div onClick={() => setAba('resumo')} className={`aba-btn ${aba === 'resumo' ? 'aba-ativa' : ''}`}>RESUMO</div>
                    </div>

                    {aba === 'pedir' ? (
                        <div className="p-6 space-y-4">
                            <input placeholder="Nome Cliente" className="w-full p-3 border rounded-xl" value={form.cliente} onChange={e => setForm({...form, cliente: e.target.value})} />
                            <input placeholder="WhatsApp" className="w-full p-3 border rounded-xl" value={form.tel} onChange={e => setForm({...form, tel: e.target.value})} />
                            <div className="pt-4 border-t">
                                {form.itens.map((it, i) => (
                                    <div key={i} className="flex gap-2 mb-2">
                                        <input list="racas" placeholder="Raça" className="flex-1 p-2 border rounded-lg bg-gray-50" value={it.raca} onChange={e => {
                                            const n = [...form.itens]; n[i].raca = e.target.value; setForm({...form, itens: n});
                                        }} />
                                        <input type="number" placeholder="Qtd" className="w-20 p-2 border rounded-lg bg-gray-50 text-center" value={it.qtd} onChange={e => {
                                            const